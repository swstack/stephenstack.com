<div id="row-login" class="row">
    <div class="col-lg-8 col-offset-3">
        <h2>Login with, </h2>
        <div id="signinBtn" class="gplusButton">
            <span class="icon"></span>
            <span class="buttonText">Google</span>
        </div>
    </div>
</div>

<div id="row-profile" class="row" style="display: none">
    <table id="login-table">
        <tr>
            <td colspan="2">
                <h2 id="welcome_back">Welcome back, </h2>
            </td>
        </tr>
        <tr>
            <td>
                <div id="profile">
                    <div id="user_profile_pic"></div>
                </div>
            </td>
            <td>
                 <div id="logoutBtn" class="gplusButton">
                    <span class="icon"></span>
                    <span class="buttonText">Logout</span>
                </div>
            </td>
        </tr>
    </table>
</div>

<div class="row">
    <div class="col-lg-12">
        <h1 id="site_end">return);</h1>
    </div>
</div>

<script type="text/javascript">
	function onSignInCallback(authResult) {
	    if (authResult['access_token']) {
	    	// success, user signed in
	    	_signIn(authResult.code);
            $('#row-profile').show('slow');
            $('#row-login').hide();
        } else if (authResult['error']) {
           // error, user not signed in
           console.log('There was an error: ' + authResult['error']);
           $('#row-profile').hide('slow');
           $('#row-login').show();
        }
	}
	
	function _signIn(auth_code) {
		$.ajax({
	        type : 'POST',
	        url : '/login/{{ STATE }}',
	        contentType : 'application/octet-stream; charset=utf-8',
	        success : function(userData) {
	        	_renderProfile($.parseJSON(userData));
	        },
	        processData : false,
	        data : auth_code
	    });
	}
	
	function _renderProfile (userData) {
		$("#welcome_back").append(userData.displayName);
		$("#user_profile_pic").append(
				$('<p><img src=\"' + userData.image.url + '\"></p>')
		);
	}
	
	$("#logoutBtn").click(function(){
		$.ajax({
			type : 'POST',
            url : "/logout",
            async : false,
            success : function(result) {
                console.log('revoke response: ' + result);
                $('#row-profile').hide();
                $('#profile').empty();
                $('#row-login').show();
            },
            error : function(e) {
                console.log(e);
            }
        });
	});
</script>
